<!DOCTYPE html>
<html>
<head>
  <title>Chat</title>
</head>
<body>
  <h1>Person to csr</h1>

  <div id="room-id">
    <label for="user-name">Name: </label>
    <input type="text" id="user-name">
    <br>
    <label for="room-id-input">Room ID: </label>
    <input type="text" id="room-id-input">
    <br>
    <button id="join-room">Join Room</button>
  </div>

  <div id="chat-room" style="display: none;">
    <h2>Chat Room</h2>
    <div id="current-room"></div>
    <div id="messages"></div>
    <input type="text" id="message-input">
    <button id="send">Send</button>
  </div>

  <script>
    const userNameInput = document.getElementById('user-name');
    const roomIdInput = document.getElementById('room-id-input');
    const joinRoomButton = document.getElementById('join-room');
    const chatRoomDiv = document.getElementById('chat-room');
    const currentRoomDiv = document.getElementById('current-room');
    const messagesDiv = document.getElementById('messages');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send');

    let roomId = '';
    let userId = '';

    joinRoomButton.addEventListener('click', () => {
      const userName = userNameInput.value;
      roomId = roomIdInput.value;

      if (userName && roomId) {
        userId = userName;

        // Display the current room ID
        currentRoomDiv.textContent = `Room ID: ${roomId}`;

        // Hide room joining UI and show the chat room
        document.getElementById('room-id').style.display = 'none';
        chatRoomDiv.style.display = 'block';

        // Connect to the WebSocket using the room ID and user ID
        const websocket = new WebSocket(`ws://172.168.1.212:8086/api/chat/${roomId}/${userId}`);

        websocket.onmessage = (event) => {
          const message = JSON.parse(event.data);
          const messageDiv = document.createElement('div');
          messageDiv.textContent = `${message.sender}: ${message.text}`;
          messagesDiv.appendChild(messageDiv);
        };

        sendButton.addEventListener('click', () => {
          const message = messageInput.value;

          // Send the message through the WebSocket
          websocket.send(JSON.stringify({ chat_room_id:roomId, receiver_id: "1", message, "sender_id": "8","sender":"Testest", "room_code":roomId}));

          // Clear the input field
          messageInput.value = '';
        });
      }
    });
  </script>
</body>
</html>